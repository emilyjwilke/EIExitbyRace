---
title: "Final Project"
author: "Maiko Hata & Michelle Cui"
format: pdf
csl: apa.csl
execute: 
  eval: true 
  echo: false
  message: false 
  warning: false
editor: visual
bibliography: references.bib
---

# Introduction

The Individuals with Disabilities Education Act (IDEA) Part C is a federal grant program that supports states in providing Early Intervention (EI) services for children zero to two who experience developmental delays and/or disabilities (Early Childhood Technical Assistance Center, 2023). These EI services incorporate family-centered practices, aiming to support caregivers' understanding of their children to provide the most effective support for their development (Romano, 2006). However, racially and/or linguistically minoritized children are less likely than White, English speaking monolingual children to receive EI services [@morgan2012] despite federal mandates to reach the most marginalized, hard-to-reach communities.

The IDEA Section 618 requires that the data is collected on children with an active IFSP who stopped receiving EI services (U.S. Department of Education \[DOE\], 2024). Recent data revealed that racially and/or linguistically marginalized infants and toddlers are much more likely to leave EI services via disqualification from EI services due to non-response to agencies’ outreach efforts after they had been made eligible.

The purpose of this study is to explore the patterns in which families from racially and/or linguistically marginalized communities leave EI services by examining extant data on EI exit between 2013-2022. The data was obtained from the Office of Special Education Services (OSEP, 2024). The research questions are as follows:

-   What are the associations between children's race and their reasons for exiting EI services, as analyzed through descriptive statistics, including chi-square tests and odds ratio analysis? For this project, we looked at the associations between children's race (Black/African American and White) and the exit reason of disqualification due to non-response rate.

# **Methods**

**Independent variables (IV)**: Student' race served as the independent variable (IV), while exit reason served as the dependent variable (DV). There were seven racial categories serving as IVs (Alaska Native/American Indian, Asian, Black/African American, Hispanic, Multiracial, Pacific Islander, White). We briefly discussed collapsing racial categories in order to make the analysis more powerful (as Maiko will also be working on state-level data with cells with no data as certain populations are very underrepresented). However, we decided against doing so as this would likely obscure the results, as there are large disparities in exit reasons within BIPOC populations.

**Dependent variables (DV)**: There are ten exit categories under three general exit reason “umbrellas” (Hansen et al., 2 016). The three reasons

```{r include=FALSE}
library(tidyverse)
library(here)
library(rio)
library(knitr)
library(gt)
library(DT)
library(reactable)
library(gtsummary)
library(kableExtra)
library(tinytex)
library(janitor)
library(tidylog)
library(sjPlot)
library(lme4)
library(tibble)
library(dplyr)
library(epitools)
library(readxl)
```

```{r}
exit_categories <- import(here("Data","exit_categories.xlsx")) %>%
 clean_names() 
```

```{r}
kable(exit_categories, caption = "Table of Exit Reasons")
```

These ten categories were then collapsed into six categories, based on the scope of the study and for logistical reasons (e.g. "Deceased" category is beyond the scope of this study; one code is not being used in Oregon; multiple codes were similar in nature to each other):

-   Attempts to contact unsuccessful (DQ)
-   Withdrawal by parent (Withdrawal)
-   Complete/not eligible for Part B (Complete or Not Eligible)
-   Moved out of state (Moved Out)
-   Part B eligibility not determined (Eligibility Not Determined)
-   Part B eligible (Eligible)

**Preparatory work**: As the original data sets from OSEP contained dependent variables that are beyond the scope of this study (e.g. "deceased"), we prepared the data specified below:

1.  Created an Excel sheet from the national and Oregon data sets
2.  Imported Excel sheet into RStudio
3.  Collapsed/removed DVs
4.  Collapsed multiple years into one aggregated data by race

**Data Analysis**: We used chi-square goodness of fit test to understand associations between children's race and their EI exit reasons on multiple levels. First, we ran descriptive analysis of the national dataset as an omnibus test. For this, we used fundamental statistical functions and ran chi-square to test our null-hypothesis, which was that there was no associations between children's races and their exit reasons.

We then analyzed the association between the exit reason, "Attempts to Contact Unsuccessful", to run similar analysis. For this analysis, we looked at the association between two racial categories, Black/African American and White children's groups, with this exit reason. We created 2x2 table for these groups, complete with the total number of exit that year. This also enabled us to analyze the odd ratio.

# Results

The initial exploration included exit data from 3,310,559 children who exited the EI services between 2013 and 2022 nationally. Approximately \_\_% of the children were Black/African American, while \_\_\_ children were reported as being White. The chi-square omnibus test indicated that there was a statistically significant association between children's race and their exit reasons, X-squared (30, N = 3,310,559) = 52218, *p* \< 2.2e-16 or 0.00000000000000022.
```{r}
# I tried to inline code here, but didn't work: 
# (The chi-square test statistic is `r round(omni_statistic, 2)`, with a p-value of `r format.pval(omni_p_value, digit = 3)`.
```


```{r include=FALSE}
# importing the data and cleaning it up 
byrace <- import(here("Data", "race v.2.xlsx")) %>% 
  clean_names() %>% 
  select(-7, -12) %>% 
  mutate(complete_or_not_eligible = complete_prior_to_reaching_max_age_for_part_c + not_eligible_for_part_b_exit_with_no_referrals + not_eligible_for_part_b_exit_with_referrals_to_other_programs)

# str(byrace) I think we can remove this because it is only for examining the structure
```

```{r}
#| labs: exit-total
# Do we need to use this table to report the white and black students percentage? Or we can show the result using an inline code in the Results section

# Created two objective that show percentage and total exits - 1127

# percentage_by_race <- byrace %>% 
#   filter(area == "US and Outlying Areas") %>% 
#   group_by(race) %>% 
#   summarize(
#     total_exit = sum(exiting_total2),
#     .groups = "drop"
#     ) %>% 
#   mutate(percentage = round(total_exit/sum(total_exit), digits = 3)*100)
# percentage_by_race %>% 
#   gt()

other_by_race <- byrace %>% 
  filter(area == "US and Outlying Areas") %>% 
  group_by(race) %>% 
  summarize(
    total_exit = sum(exiting_total2),
    .groups = "drop"
    ) %>% 
  mutate(percentage = round(total_exit/sum(total_exit), digits = 3)*100)

oregon_by_race <- byrace %>% 
  filter(area == "Oregon") %>% 
  group_by(race) %>% 
  summarize(
    total_exit = sum(exiting_total2),
    .groups = "drop" # .groups = drop: All levels of grouping are dropped.
  ) %>% 
  mutate(percentage = round(total_exit/sum(total_exit), digits = 3)*100)

```

```{r}
# aggregated by race and stte
agg_by_race_and_state <- byrace %>% 
  group_by(race, area) %>% 
  summarize(exit_total = sum(exiting_total2), 
            withdrawal_by_parent = sum(withdrawal_by_parent),
            attempts_to_contact_unsuccessful = sum(attempts_to_contact_unsuccessful),
            moved_out_of_state = sum(moved_out_of_state),
            part_b_eligible_exiting_part_c = sum(part_b_eligible_exiting_part_c),
            complete_or_not_eligible = sum(complete_or_not_eligible))

# aggregated by race for OR
race_oregon <- agg_by_race_and_state %>%
  filter(area == "Oregon")

# aggregated by race for US
race_us <- agg_by_race_and_state %>% 
  filter(area == "US and Outlying Areas")

```

```{r}
# run a quick chi square tests for trial/Omnibus. Saving the p-value and test-statistics p value and result 
chi_omni <-chisq.test(race_us[, 3:8])
omni_p_value <- chi_omni$p.value
omni_statistic <- chi_omni$statistic

# chisq.test(race_oregon[, 3:8])
```

```{r}
# We were curious if PI's (Pacific Islanders) small numbers skewed the chi-square, so we took it out and ran it again. It doesn't seem to have impacted much as P value is still very small with or without PI data. 
race_oregon_subset <- race_oregon %>% 
  filter(race != "PI")
# chisq.test(race_oregon_subset[, 3:8])
```

Looking specifically at the Attempts to Contact Unsuccessful/DQ category nationally, approximately 13.5% of Black/African American children exited EI per disqualification due to agencies losing contact with families, while only about 5.98% of White children were disqualified from services for the same reason (Figure 1). The chi-square indicated that there was a statistically significant association between children being Black/African American or White and them leaving EI due to being disqualified, (CHI SQUARE VALUES BASED ONLY ON THE us_data_DQ_proportion BUT WITH JUST BLACK AND WHITE!)

```{r}
# trial bar charts 
# ggplot(oregon_data_long, 
# aes(x = race, y = percentage, fill = race)) +  
#  geom_bar(stat = "identity", position = "dodge") +
#  theme_minimal() +
#  facet_wrap(~ names)
```

```{r}
# US long and wide  

us_data_long <- race_us %>% 
  pivot_longer(
    cols = 4:8,
    values_to = "values",
    names_to = "names"
  ) %>% 
  group_by(race) %>% 
  mutate(percentage = round(values/exit_total, digits = 4))

us_data_wide <- us_data_long %>% 
  select(-c(exit_total,values)) %>% 
  pivot_wider(
    names_from = names,
    values_from = percentage
  )
```

```{r}
agg_by_area <- byrace %>% 
  group_by(area) %>% 
  summarize(exit_total = sum(exiting_total2), 
            withdrawal_by_parent = sum(withdrawal_by_parent))
# chisq.test(agg_by_area[, 2:3])

```

```{r}
data_oregon <- byrace %>% 
  filter(area == "Oregon") %>% 
  group_by(race) %>% 
  summarize(exit_total = sum(exiting_total2), 
            withdrawal_by_parent = sum(withdrawal_by_parent)) %>% 
  mutate(proportion = withdrawal_by_parent / exit_total)

# chi square for oregon 
# chisq.test(data_oregon[, 2:3])
```

```{r}
# data national 
data_national <- byrace %>% 
  filter(area == "US and Outlying Areas") %>% 
  group_by(race) %>% 
  summarize(exit_total = sum(exiting_total2), 
            withdrawal_by_parent = sum(withdrawal_by_parent)) %>% 
  mutate(proportion = withdrawal_by_parent / exit_total)

# chisq.test(data_oregon[, 2])
```

```{r}
# figure 1 for DQ data in US - HOW CAN I ADD DATA LBELS WITH % ON EACH BAR? 

us_data_wide <- us_data_wide %>% 
  select(race, attempts_to_contact_unsuccessful) %>% 
    mutate(attempts_to_contact_unsuccessful = attempts_to_contact_unsuccessful * 100)
```

```{r}
# figure 1 continues 
ggplot(us_data_wide, aes(x = race, y = attempts_to_contact_unsuccessful)) +
  geom_bar(stat = "identity", fill = "gray43") +
  labs(
    title = "Figure 1: Unsuccessful Contacts/DQ (U.S.)", 
    x = "Race", 
    y = "Percentage of Exit by Race"
  ) +
  theme_minimal()
```

```{r}
# figure 1 continues 
# I NEED TO KEEP THE TOTAL NUMBER OF EXIT IN THIS CHART TO RUN CHI SQUARE 
us_data_wide_DQ_BLWH <- us_data_wide %>% 
  select(race, attempts_to_contact_unsuccessful) %>% 
  filter(race == "BL" | race == "WH") %>% 
  mutate(attempts_to_contact_unsuccessful = attempts_to_contact_unsuccessful)
```

```{r}
# Oregon data long and wide
oregon_data_long <- race_oregon %>% 
  pivot_longer(
  cols = 4:8,
  values_to = "values",
  names_to = "names"
 ) %>% 
  group_by(race) %>% 
  mutate(percentage = round(values/exit_total, digits = 4))

oregon_data_wide <- oregon_data_long %>% 
  select(-c(exit_total,values)) %>% 
  pivot_wider(
    names_from = names,
    values_from = percentage
  )
```

```{r}
# figure 2 for Oregon DQ data 
oregon_data_wide_DQ <- oregon_data_wide %>% 
  select(race, attempts_to_contact_unsuccessful) %>%  
  mutate(
    attempts_to_contact_unsuccessful = attempts_to_contact_unsuccessful * 100
  )

```

```{r}
# figure 2 continues 
 ggplot(oregon_data_wide_DQ, 
        aes(x = race, y = attempts_to_contact_unsuccessful)) +
  geom_col(stat = "identity", fill = "green4", position = 'dodge') +
   geom_text(aes(label = attempts_to_contact_unsuccessful),
             position = position_dodge(0.9),
             vjust = -0.3) +
  labs(
    title = "Figure 2: Unsuccessful Contacts/DQ (Oregon)", 
    x = "Race", 
    y = "Percentage of Exit by Race"
  ) +
  theme_minimal()
 
 # print(oregon_data_wide_DQ) 
```

```{r}
# do we need a contingency table? 
# c_table <- table(us_data_wide_DQ_BLWH$race, 
# us_data_wide_DQ_BLWH$attempts_to_contact_unsuccessful)
```

```{r}
# Did I just make the summary table of what we decided to look at for this project!?!? 
# WE STILL HAVE TO FILTER ONLY BL AND WHITE BEFORE RUNNING THE CHI SQUARE 
us_data_DQ <- byrace %>% 
  filter(area == "US and Outlying Areas") %>% 
  group_by(race) %>% 
  summarize(exit_total = sum(exiting_total2), 
            attempts_to_contact_unsuccessful = sum(attempts_to_contact_unsuccessful))
```

```{r}
# and did I just run the chi-square for the dataset!?!? NOPE!
# WE STILL HAVE TO FILTER ONLY BL AND WHITE BEFORE RUNNING THE CHI SQUARE 
chisq.test(us_data_DQ[, 2])
```

```{r}
us_data_DQ_proportion <- byrace %>% 
  filter(area == "US and Outlying Areas") %>% 
  group_by(race) %>% 
  summarize(exit_total = sum(exiting_total2), 
            attempts_to_contact_unsuccessful = sum(attempts_to_contact_unsuccessful)) %>% 
  mutate(proportion = (attempts_to_contact_unsuccessful / exit_total) * 100) 
```

# Discussion

QuantCrit

It's not a "risk factor"

\newpage

# References

Early Childhood Technical Assistance Center \[ecta\], (2023, October 6). *Part C of IDEA*. ecta. <https://ectacenter.org/partc/partc.asp>

Romano, S.D. (2006). Historical perspectives. In G. M. Foley & J.D. Hochman (Eds.), *Mental health in early intervention: Achieving unity in principles and practice* (pp. 33-58). Baltimore: Paul H. Brookes Publishing Company.
